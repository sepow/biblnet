{% extends "tribes/base.html" %}

{% load microblogging_tags %}
{% load i18n %}
{% load uni_form %}
{% load wiki %}
{% load wikiurl %}
{% load avatar_tags %}
{% load threadedcommentstags %}
{% load pagination_tags %}
{% load extra_tagging_tags %}
{% load tribe_tags %}

{% block head_title %}{{ tribe.name }}{% endblock %}

{% block boxtab_id %}id="index_tab"{% endblock %}

{% block body %}
{% load condition_tag %}
    {% if_can_see tribe user %}

    <div>
    <!--div style="width: 550px;"-->
        
        <h2>{% trans "Welcome to" %} {{ tribe.name }}</h2>

        <p>{{ tribe.description }}</p>

    {% if user.is_authenticated %}
        <p>
            {% trans "Creator:" %} <a href="{% url profile_detail tribe.creator.username %}">{{ tribe.creator }}</a><br />
            {% trans "Created:" %} {{ tribe.created|date }}<br />
            {% show_tags_for tribe %}
        </p>
        
        <div>
            <form method="POST" action="">
                {% if are_member %}
                    {% ifequal user tribe.creator %}
                        <p>{% trans "You are the creator of this tribe so can't leave (yet)." %}</p>
                    {% else %}
                        <input type="hidden" name="action" value="leave" />
                        <input type="submit" value="{% trans "leave tribe" %}"/>
                    {% endifequal %}
                {% else %}
                    <input type="hidden" name="action" value="join" />
                    <input type="submit" value="{% trans "join tribe" %}"/>
                {% endif %}
            </form>
        </div>
    {% else %}
        {% url acct_signup as signup_url %}
        {% url acct_login as login_url %}
        <p>{% blocktrans %}<a href="{{ signup_url }}">Sign up</a> and <a href="{{ login_url }}">log in </a> to join this tribe.{% endblocktrans %}</p>
    {% endif %}


        {% if user.is_authenticated %}
          
            <h2>{% trans "Discussion Topics" %}{% if tribe.topics.all.count %} ({{ tribe.topics.all.count }}){% endif %}</h2>
            <table class="topics">
            {#<tr class="even"><th></th><th>{% trans "Topic" %}</th><th>{% trans "Started by" %}</th><th>{% trans "Views" %}</th><th>{% trans "Replies" %}</th><th>{% trans "Latest reply" %}</th><th>{% trans "Tags" %}</th></tr>#}
            <tr class="even"><th width="35px"></th><th width="25%">{% trans "Topic" %}</th><th width="15%">{% trans "Started by" %}</th><th width="7%">{% trans "Views" %}</th><th width="8%">{% trans "Replies" %}</th><th width="25%">{% trans "Latest reply" %}</th><th>{% trans "Tags" %}</th></tr>
            {% if topics %}
                {#% if tribe.topics.all %#}
                    {% for topic in topics %}
                        {% show_tribe_topic topic %}
                    {% endfor %}
                {#% endif %#}
            {% else %}
                {% url tribe_create_topic tribe.slug as new_topic_url %}
                <tr class="odd"><td><img src="/site_media/images/sitegraphics/pin.gif" /></td><td colspan=6>{% blocktrans %}There are no topics yet - <a href="{{ new_topic_url }}">start one...</a>{% endblocktrans %}</td></tr>
            {% endif %}
            </table>            
            
            <h2>{% trans "Wiki Articles" %}{% if total_articles %} ({{ total_articles }}){% endif %}</h2>
            
            {% if articles %}
                <table class="topics">
                    {% for article in articles %}
                        {% show_teaser article %}
                    {% endfor %}
                </table>
                <p><a href="{% wikiurl list tribe %}">{% trans "more..." %}</a></p>
            {% else %}
                {% wikiurl list tribe as wiki_url %}
                <p>
                    {% blocktrans %}
                        None yet. Go to the <a href="{{ wiki_url }}" title="wiki">wiki</a> to start a new article.
                    {% endblocktrans %}
                </p>
            {% endif %}
            
            <h2>{% trans "Tweets" %}</h2>
            
            {% tweet_listing tweets 1 0 %}            
            
            {% if photos %}
                <h2>{% trans "Tribe Photo Pool" %}</h2>
                <div class="thumb-row clearfix">
                    {% for photo in photos %}
                    <div class="gallery-photo-thumb">
                        <a href="/photos/details/{{ photo.photo.id }}/"><img src="{{ photo.photo.get_thumbnail_url }}" alt="{{ photo.photo.title }}"/></a><br />
                        <img src="{{ MEDIA_URL }}pinax/images/silk/icons/comment.png" border="0" class="noborder" align="absmiddle" /><a href="/photos/details/{{ photo.photo.id }}/">{% get_comment_count for photo as commentcount %} {% blocktrans %}{{ commentcount }} Comments {% endblocktrans %}</a>
                   </div>
                   {% endfor %}
               </div>
            {% endif %}
        {% endif %}
    </div>

    {% else %}
    {% trans "... This is a private group!" %}
    {% endif_can_see %}
{% endblock %}
